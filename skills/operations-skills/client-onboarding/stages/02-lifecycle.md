# Phase 2.5: Lifecycle Mapping

This stage captures the client's actual customer journey stages and maps them to MH1's canonical lifecycle model.

---

## Purpose

Generic funnel stages (lead → MQL → SQL → customer) don't match every business. This phase:
1. Discovers the client's actual funnel terminology
2. Maps their stages to canonical lifecycle stages
3. Enables all downstream analysis skills to use client-specific language

---

## When to Run

- During initial client onboarding
- When client's business model changes significantly
- When adding new product lines with different funnels
- Before running ICP Research or Lifecycle Audit workflows

---

## Lifecycle Questionnaire

### Step 2.5.1: Gather Stage Information

Ask the client (or analyze their CRM/data) to capture:

```yaml
lifecycle_questionnaire:
  # 1. Discovery stage - How do people find you?
  discovery:
    question: "What do you call someone who just discovered your company?"
    examples: ["Visitor", "Lead", "Prospect", "Subscriber"]
    events: "What actions indicate discovery? (e.g., page_view, signup, download)"

  # 2. Qualification stage - How do you qualify leads?
  qualification:
    question: "What do you call someone who's qualified as a potential fit?"
    examples: ["MQL", "Qualified Lead", "Applicant", "Interested"]
    events: "What actions indicate qualification? (e.g., form_submit, demo_request, application_started)"

  # 3. Sales stage - When does sales engage?
    sales:
    question: "What do you call someone actively in your sales process?"
    examples: ["SQL", "Opportunity", "In Review", "Pipeline"]
    events: "What actions indicate sales engagement? (e.g., call_scheduled, proposal_sent)"

  # 4. Conversion stage - When do they become a customer?
  conversion:
    question: "What do you call someone when they first pay/convert?"
    examples: ["Customer", "Client", "Member", "Founder", "User"]
    events: "What actions indicate conversion? (e.g., purchase, contract_signed, deposit_paid)"

  # 5. Activation stage - When are they actively using your product?
  activation:
    question: "What indicates a customer is actively engaged?"
    examples: ["Active", "Activated", "Onboarded", "In Program"]
    events: "What actions indicate activation? (e.g., first_login, first_session, onboarding_complete)"

  # 6. Retention stage - When do you consider them retained?
  retention:
    question: "What indicates long-term retention?"
    examples: ["Retained", "Returning", "Renewed", "Advocate"]
    events: "What actions indicate retention? (e.g., renewal, repeat_purchase, referral)"

  # 7. Churn stage - When do you consider them churned?
  churn:
    question: "What indicates a customer has churned?"
    examples: ["Churned", "Cancelled", "Inactive", "Lost"]
    events: "What actions indicate churn? (e.g., subscription_cancelled, no_activity_90d, refund)"
```

---

### Step 2.5.2: Capture Custom Stages

Some businesses have unique stages. Capture any extras:

```yaml
custom_stages:
  - question: "Do you have any stages unique to your business model?"
    examples:
      - "Cohort (for cohort-based programs)"
      - "Trial (for free trial products)"
      - "Pilot (for enterprise sales)"
      - "Waitlist (for limited capacity)"
    follow_up: "Where does this stage fit in your funnel? (before/after which stage?)"
```

---

### Step 2.5.3: Capture Business Goals

```yaml
business_goals:
  conversion_rate_target:
    question: "What's your target conversion rate from lead to customer?"
    default: 0.05  # 5%

  retention_rate_target:
    question: "What's your target retention rate?"
    default: 0.70  # 70%

  time_to_convert:
    question: "What's your typical time from lead to customer?"
    examples: ["7 days", "30 days", "90 days", "6 months"]

  high_value_threshold:
    question: "What contract/purchase value do you consider 'high value'?"
    examples: ["$10,000", "$50,000", "$100,000"]
```

---

## Output: Lifecycle Configuration

Generate and store the lifecycle configuration:

### File: `clients/{client_id}/context/lifecycle.yaml`

```yaml
# Client Lifecycle Configuration
# Generated by client-onboarding Phase 2.5
# Generated: {timestamp}

client_id: "{client_id}"
client_name: "{company_name}"
business_model: "{business_model}"  # saas, ecommerce, b2b_services, cohort_program, etc.

# =============================================================================
# STAGE DEFINITIONS
# =============================================================================
# Maps client's terminology to canonical lifecycle stages

stages:
  # Stage 1: Discovery/Awareness
  - name: "{client_discovery_stage_name}"
    canonical: "awareness"
    description: "{description}"
    order: 1
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"

  # Stage 2: Lead/Contact Captured
  - name: "{client_lead_stage_name}"
    canonical: "lead"
    description: "{description}"
    order: 2
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"
    is_conversion: true

  # Stage 3: Marketing Qualified
  - name: "{client_mql_stage_name}"
    canonical: "mql"
    description: "{description}"
    order: 3
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"

  # Stage 4: Sales Qualified
  - name: "{client_sql_stage_name}"
    canonical: "sql"
    description: "{description}"
    order: 4
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"

  # Stage 5: Customer
  - name: "{client_customer_stage_name}"
    canonical: "customer"
    description: "{description}"
    order: 5
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"
    is_conversion: true
    is_critical_conversion: true

  # Stage 6: Active/Activated
  - name: "{client_active_stage_name}"
    canonical: "activated"
    description: "{description}"
    order: 6
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"

  # Stage 7: Retained
  - name: "{client_retained_stage_name}"
    canonical: "retention"
    description: "{description}"
    order: 7
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"
    is_conversion: true

  # Stage 8: Churned (negative)
  - name: "{client_churned_stage_name}"
    canonical: "churned"
    description: "{description}"
    order: 8
    events:
      - "{event_1}"
      - "{event_2}"
    crm_stage: "{corresponding_crm_lifecycle_stage}"
    is_negative: true

# =============================================================================
# CUSTOM STAGES (if any)
# =============================================================================

custom_stages:
  # Example for cohort-based business:
  # - name: "Cohort Member"
  #   canonical: "activated"  # Maps to closest canonical
  #   after_stage: "Customer"
  #   before_stage: "Retained"
  #   description: "Active participant in a cohort program"
  #   events: ["cohort_started", "session_attended"]

# =============================================================================
# BUSINESS GOALS
# =============================================================================

goals:
  conversion_rate_target: {conversion_rate}  # Lead → Customer
  retention_rate_target: {retention_rate}
  time_to_convert_days: {days}
  high_value_min: {amount}  # Dollar amount for "high value" accounts

# =============================================================================
# SEGMENT HYPOTHESES
# =============================================================================
# Initial hypotheses about customer segments (to be validated)

segments_hypothesized:
  - name: "{segment_1}"
    description: "{description}"
    characteristics:
      - "{characteristic_1}"
      - "{characteristic_2}"

  - name: "{segment_2}"
    description: "{description}"
    characteristics:
      - "{characteristic_1}"
      - "{characteristic_2}"

# =============================================================================
# CANONICAL MAPPING
# =============================================================================
# Quick lookup from canonical stage to client stage

canonical_to_client:
  awareness: "{client_discovery_stage_name}"
  lead: "{client_lead_stage_name}"
  mql: "{client_mql_stage_name}"
  sql: "{client_sql_stage_name}"
  customer: "{client_customer_stage_name}"
  activated: "{client_active_stage_name}"
  retention: "{client_retained_stage_name}"
  churned: "{client_churned_stage_name}"

# =============================================================================
# FUNNEL DEFINITION
# =============================================================================
# Primary funnel for analysis

primary_funnel:
  name: "{company_name} Customer Journey"
  stages:
    - "{stage_1}"
    - "{stage_2}"
    - "{stage_3}"
    - "{stage_4}"
    - "{stage_5}"

# =============================================================================
# METADATA
# =============================================================================

metadata:
  created_at: "{timestamp}"
  created_by: "client-onboarding"
  version: "1.0.0"
  last_validated: null
  validation_notes: null
```

---

## Industry Templates

Pre-fill from industry templates when available:

### SaaS Template

```yaml
stages:
  - name: "Visitor"
    canonical: "awareness"
    events: ["page_view", "blog_read"]

  - name: "Lead"
    canonical: "lead"
    events: ["newsletter_signup", "content_download"]

  - name: "Trial User"
    canonical: "mql"
    events: ["trial_started", "demo_requested"]

  - name: "Sales Qualified"
    canonical: "sql"
    events: ["demo_completed", "pricing_discussed"]

  - name: "Customer"
    canonical: "customer"
    events: ["subscription_started", "payment_received"]

  - name: "Active User"
    canonical: "activated"
    events: ["feature_used", "daily_login"]

  - name: "Retained"
    canonical: "retention"
    events: ["renewal_completed", "plan_upgraded"]

  - name: "Churned"
    canonical: "churned"
    events: ["subscription_cancelled", "no_login_30d"]
```

### Cohort Program Template (e.g., Founder Program)

```yaml
stages:
  - name: "Applicant"
    canonical: "lead"
    events: ["application_started", "application_submitted"]

  - name: "Accepted"
    canonical: "mql"
    events: ["acceptance_sent", "deposit_paid"]

  - name: "Cohort Member"
    canonical: "customer"
    events: ["cohort_started", "first_session"]

  - name: "Active Founder"
    canonical: "activated"
    events: ["session_attended", "milestone_completed"]

  - name: "Alumni"
    canonical: "retention"
    events: ["cohort_completed", "second_cohort_joined"]

  - name: "Disengaged"
    canonical: "churned"
    events: ["no_activity_90d", "refund_requested"]
```

### E-commerce Template

```yaml
stages:
  - name: "Browser"
    canonical: "awareness"
    events: ["page_view", "product_view"]

  - name: "Subscriber"
    canonical: "lead"
    events: ["email_signup", "account_created"]

  - name: "Cart Adder"
    canonical: "mql"
    events: ["add_to_cart", "wishlist_add"]

  - name: "Checkout Started"
    canonical: "sql"
    events: ["checkout_started", "shipping_entered"]

  - name: "Customer"
    canonical: "customer"
    events: ["order_completed", "payment_confirmed"]

  - name: "Repeat Customer"
    canonical: "retention"
    events: ["second_order", "review_submitted"]

  - name: "Lapsed"
    canonical: "churned"
    events: ["no_purchase_180d", "unsubscribed"]
```

---

## Integration Points

### With lifecycle-audit skill

The lifecycle-audit skill reads `clients/{client_id}/context/lifecycle.yaml` to:
- Use client's stage names in reports
- Map CRM contacts to client's funnel stages
- Calculate conversion rates between client-defined stages

### With cohort-retention-analysis skill

The cohort-retention skill uses lifecycle mapping to:
- Define retention based on client's "retained" stage
- Define churn based on client's "churned" stage
- Group cohorts by client-meaningful time periods

### With ICP research workflow

The ICP workflow uses lifecycle mapping to:
- Analyze which ICPs progress through the funnel
- Identify where different segments drop off
- Correlate interview insights with funnel behavior

---

## Validation

Before saving, validate:

1. **Completeness**: All canonical stages have a mapping
2. **Order**: Stages are in logical progression order
3. **Events**: At least one event per stage
4. **Uniqueness**: No duplicate stage names

```python
def validate_lifecycle_config(config: dict) -> bool:
    required_canonical = ["awareness", "lead", "customer", "churned"]

    mapped_canonical = [s["canonical"] for s in config["stages"]]

    for required in required_canonical:
        if required not in mapped_canonical:
            raise ValueError(f"Missing required canonical stage: {required}")

    # Check order is sequential
    orders = [s["order"] for s in config["stages"]]
    if orders != sorted(orders):
        raise ValueError("Stage orders must be sequential")

    return True
```

---

## Output

After completing this phase:

```json
{
  "phase": "2.5",
  "phase_name": "Lifecycle Mapping",
  "status": "complete",
  "outputs": {
    "lifecycle_config": "clients/{client_id}/context/lifecycle.yaml",
    "stages_mapped": 8,
    "custom_stages_added": 1,
    "business_model": "cohort_program"
  },
  "next_phase": "3"
}
```
