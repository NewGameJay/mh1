# Stage 1.75: Topic Curation

**Duration**: 2-3 minutes
**Agent**: linkedin-topic-curator
**Blocking**: YES - selectedTopics required for Stage 2

## Purpose

Invoke the `linkedin-topic-curator` agent to analyze external signals (thought leaders, news, social posts) and generate scored topic suggestions. This stage isolates topic analysis context from the ghostwriting context.

## Client Info (from active_client.md)

```
CLIENT_ID = {parsed from inputs/active_client.md}
CLIENT_NAME = {parsed from inputs/active_client.md}
FOLDER_NAME = {parsed from inputs/active_client.md}
```

## Prerequisites

- Stage 1 complete: All context loaded
- NOT in `--context-only` mode (otherwise, workflow exited at Stage 1.5)

## Inputs

| Input | Source | Description |
|-------|--------|-------------|
| `thought_leader_posts.json` | Stage 1.6 | Thought leader profiles and posts |
| `parallel_events.json` | Stage 1.7 | Industry news and events |
| `source_posts.json` | Stage 1.1 | Social listening posts |
| `--post-count` | Command arg | Number of posts to generate |
| `--auto-topics` | Command arg | Auto-select mode (skip interactive) |

## Outputs

| Output | Type | Description |
|--------|------|-------------|
| `selectedTopics` | JSON | Scored and selected topics |
| `runId` | string | Firestore contentCalendar persistence ID |

---

## Agent Invocation

```
Task tool: linkedin-topic-curator
Prompt: Analyze thought leader posts, parallel events, and social listening data to generate topic suggestions for {--post-count} LinkedIn posts for {CLIENT_NAME} (client_id={CLIENT_ID}, founder_id={FOUNDER_ID}). Selection mode: {interactive|auto-topics}.
```

### Input Context (pass to agent)

1. **Thought Leader JSON** - From `thought_leader_posts.json`
2. **Parallel Events JSON** - From `parallel_events.json`
3. **Social Listening JSON** - From `source_posts.json`
4. **Selection Mode** - `interactive` (default) or `auto` (if `--auto-topics` flag set)
5. **Post Count** - `{--post-count}` (default: 20)
6. **Client/Founder IDs** - `{CLIENT_ID}`, `{FOUNDER_ID}`

### Agent Responsibilities

The `linkedin-topic-curator` agent handles internally:
- Load moderate company context from Firestore (brand.companyProfile, messaging.positioning, audience.icpTargets, strategy.positioning)
- Load founder topThemes from Firestore (for content gap analysis)
- Extract themes from thought leaders, events, social posts
- Score topics using 10-point scale (timeliness, ICP relevance, strategic fit, content gap)
- Categorize into 3 groups (Thought Leader, Events, Strategic)
- Present to user via AskUserQuestion (interactive mode) OR auto-select (--auto-topics mode)
- Persist selections to Firestore `clients/{CLIENT_ID}/contentCalendar/{runId}`

---

## Expected Output

The agent returns:

```json
{
  "runId": "2026-01-04T10-30-00Z",
  "clientId": "{CLIENT_ID}",
  "founderId": "{FOUNDER_ID}",
  "platform": "linkedin",
  "postCountRequested": 20,
  "autoSelected": false,
  "selectedTopics": [
    {
      "id": 1,
      "topic": "AI Marketing Transformation",
      "type": "theme|specific",
      "source": "thought-leader|parallel-event|strategic",
      "sourceRef": "thoughtLeaders/{id}|parallelEvents/{id}|null",
      "postCount": 3,
      "funnelStage": "TOFU|MOFU|BOFU",
      "score": 8.5,
      "angles": ["VC bias", "Alternative funding", "Community support"],
      "inspirationSummary": "Brief summary of inspiration source (2-3 sentences)",
      "citationRule": "metadata-only"
    }
  ],
  "customTopics": [],
  "sourceSummary": {
    "thoughtLeadersAnalyzed": 8,
    "parallelEventsAnalyzed": 15,
    "socialPostsAnalyzed": 25,
    "thoughtLeaderTopics": 4,
    "eventTopics": 3,
    "strategicTopics": 3
  },
  "totalPostsAllocated": 20
}
```

---

## Context Isolation Benefit

| What Topic Curator Receives | What Ghostwriter Receives |
|-----------------------------|---------------------------|
| Thought leader posts (~50) | 0 (just topic summaries) |
| Parallel events (~20) | 0 (just topic summaries) |
| Social listening posts (~25) | 0 (topic curator uses these) |
| Moderate company context | Full company context |
| Founder topThemes only | Full founder voice + posts |

**Result**: Ghostwriter context reduced from ~40K tokens to ~15K tokens.

---

## Data Storage

**Store `selectedTopics` array** in memory for use in Stage 2 and Stage 3.

The thought leader posts, parallel events, and social listening posts JSON files are NO LONGER passed to downstream stages - only the condensed `selectedTopics` with `inspirationSummary` fields.

---

## Cleanup Temp Files

After topic curator completes:

```bash
rm thought_leader_posts.json
rm parallel_events.json
```

**Keep** `source_posts.json` - used for source-data archive in Stage 5.

---

## Save Checkpoint

After topic curation completes successfully:

```bash
python skills/ghostwrite-content/scripts/checkpoint.py "{CAMPAIGN_DIR}" complete "1.75"
```

---

## Quality Gate

- [ ] linkedin-topic-curator agent invoked successfully
- [ ] selectedTopics JSON returned with valid structure
- [ ] runId returned (Firestore contentCalendar persistence confirmed)
- [ ] Total post count matches {--post-count} (within +/-2)
- [ ] selectedTopics stored in memory for Stage 2
- [ ] Thought leader/events temp files cleaned up
- [ ] Checkpoint saved

---

## Error Handling

### No Topics Generated
If agent returns 0 topics:
- Check if source data was empty (thought leaders, events, social posts)
- Suggest running data collection commands first
- Allow fallback to strategic topics only

### Topic Count Mismatch
If total allocated posts differs significantly from `--post-count`:
- Agent should adjust allocation
- Warn user if +/-3 posts different
- Allow proceeding with adjusted count

---

## Next Stage

-> [Stage 2: Template Selection](./02-template-selection.md)
