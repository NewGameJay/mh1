# Stage 5: Calendar Compilation

**Duration**: 2-3 minutes

## Purpose

Organize generated posts into a publishable content calendar. This stage creates the client-ready deliverables with scheduling recommendations.

## Client Info (from active_client.md)

```
CLIENT_ID = {parsed from inputs/active_client.md}
CLIENT_NAME = {parsed from inputs/active_client.md}
FOLDER_NAME = {parsed from inputs/active_client.md}
FOUNDER = {resolved from founders subcollection}
```

## Prerequisites

- Stage 4 complete: All posts passed QA (or flagged for manual review)

## Inputs

| Input | Source | Description |
|-------|--------|-------------|
| `final-{PLATFORM}-posts-{DATE}.json` | Stage 3/4 | QA-approved posts |
| `template-selections.json` | Stage 2 | Template metadata (LinkedIn) |
| `source_posts.json` | Stage 1 | For source-data archive |

## Outputs

| Output | Type | Description |
|--------|------|-------------|
| `README.md` | File | Campaign summary |
| `CONTENT_CALENDAR_FINAL.md` | File | Client-ready deliverable |
| `CONTENT_CALENDAR_FINAL.json` | File | Structured data |

---

## Tasks

### Task 1: Organize Posts by Funnel Stage

Sort posts into categories:
- **TOFU** (Top of Funnel): Awareness, reach, thought leadership
- **MOFU** (Middle of Funnel): Education, trust-building, expertise
- **BOFU** (Bottom of Funnel): MH-1 value, case studies, conversion

### Task 2: Create Publishing Schedule

Recommended schedule by platform:

| Platform | Frequency | Days | Time |
|----------|-----------|------|------|
| LinkedIn | 3 posts/week | Mon/Wed/Fri | 9:00 AM ET |
| Twitter | Daily+ | Any | Peak hours |

Calculate date range based on post count and frequency.

### Task 3: Generate Output Files

Create all campaign deliverables in the campaign directory.

---

## Output Structure

```
{FOLDER_NAME}/campaigns/ghostwrite-{PLATFORM}-{DATE}/
+-- README.md
+-- CONTENT_CALENDAR_FINAL.md
+-- CONTENT_CALENDAR_FINAL.json
+-- final-{PLATFORM}-posts-{DATE}.json
+-- source-data/
|   +-- template-selections.json (LinkedIn only)
|   +-- template-selections-summary.md (LinkedIn only)
|   +-- social-listening-posts.json
|   +-- context-snapshot.json
+-- posts/
    +-- batch-1-posts.json
    +-- batch-2-posts.json
    +-- ...
```

---

## README.md Format

```markdown
# Ghostwrite Campaign: {CLIENT_NAME}

**Platform**: {PLATFORM}
**Generated**: {DATE}
**Post Count**: {count}

## Campaign Overview

This campaign contains {count} social media posts generated from social listening data
in the voice of {FOUNDER_NAME}.

## Files

| File | Description |
|------|-------------|
| CONTENT_CALENDAR_FINAL.md | Client-ready content calendar |
| CONTENT_CALENDAR_FINAL.json | Structured calendar data |
| final-{PLATFORM}-posts-{DATE}.json | All posts with metadata |
| source-data/ | Supporting research data |
| posts/ | Individual batch outputs |

## Funnel Distribution

- TOFU: {n} posts ({%})
- MOFU: {n} posts ({%})
- BOFU: {n} posts ({%})

## Schedule

{X} posts/week over {Y} weeks
Starting: {start_date}
Ending: {end_date}

## Quality Metrics

- Voice Authenticity: {avg}/10 average
- QA Status: {passed}/{total} passed
- Posts requiring manual review: {n}

## Usage

1. Review posts in CONTENT_CALENDAR_FINAL.md
2. Make any necessary edits
3. Schedule in your social media management tool
4. Monitor engagement and iterate

## Generated By

ghostwrite-content skill
{timestamp}
```

---

## CONTENT_CALENDAR_FINAL.md Format

Use template from `templates/content-calendar.md`:

```markdown
# {PLATFORM} Content Calendar - {CLIENT_NAME}

**Campaign**: ghostwrite-{PLATFORM}-{DATE}
**Total Posts**: {--post-count}
**Platform**: {--platform}
**Schedule**: Mon/Wed/Fri at 9:00 AM ET (LinkedIn) / TBD (other platforms)
**Date Range**: {start_date} - {end_date}

---

## Post 1: {template_name or post_type}

**Template ID**: {template_id} (LinkedIn only)
**Scheduled Date**: {date} ({day})
**Funnel Stage**: {TOFU/MOFU/BOFU}
**Character Count**: {count}

---

### Post Text:

{post_text}

---

### Metadata:
- **Source Post**: {social_listening_post_url}
- **Relevance Score**: {score}/10
- **Context Files Used**: {firestore_paths_and_local_files}
- **Anti-AI Compliance**: {status}

***

[Repeat for all posts...]
```

---

## CONTENT_CALENDAR_FINAL.json Format

```json
{
  "campaign": {
    "client_name": "{CLIENT_NAME}",
    "platform": "{PLATFORM}",
    "generated_at": "{ISO_TIMESTAMP}",
    "post_count": 20,
    "date_range": {
      "start": "2026-01-06",
      "end": "2026-02-14"
    },
    "schedule": {
      "frequency": "3 posts/week",
      "days": ["Monday", "Wednesday", "Friday"],
      "time": "9:00 AM ET"
    }
  },
  "metrics": {
    "voice_authenticity_avg": 8.2,
    "qa_passed": 20,
    "qa_failed": 0,
    "manual_review_required": 0,
    "funnel_distribution": {
      "TOFU": 8,
      "MOFU": 8,
      "BOFU": 4
    }
  },
  "posts": [
    {
      "post_number": 1,
      "scheduled_date": "2026-01-06",
      "scheduled_day": "Monday",
      "template_id": 8,
      "template_name": "Industry hot take",
      "funnel_stage": "TOFU",
      "post_text": "...",
      "character_count": 1250,
      "metadata": {
        "voice_confidence": 8.5,
        "source_post_url": "...",
        "relevance_score": 7.8,
        "context_files_used": ["..."],
        "anti_ai_compliance": "PASS"
      }
    }
  ]
}
```

---

## Archive Source Data

Copy source files to `source-data/` for reference:

1. **Copy** `source_posts.json` -> `source-data/social-listening-posts.json`
2. **Create** `source-data/context-snapshot.json` with:
   - Client context summary
   - Founder voice summary
   - Generation parameters

3. **Clean up** temp file:
```bash
rm source_posts.json
```

---

## Save Calendar Files

**Use Python script for reliable JSON writes**:

```bash
# Save calendar JSON
python skills/ghostwrite-content/scripts/write_json.py \
  "{CAMPAIGN_DIR}/CONTENT_CALENDAR_FINAL.json" '{CALENDAR_JSON}'
```

**Use Write tool** for markdown files (CONTENT_CALENDAR_FINAL.md, README.md).

Mark stage complete:

```bash
python skills/ghostwrite-content/scripts/checkpoint.py "{CAMPAIGN_DIR}" complete "5"
```

---

## Quality Gate

- [ ] README.md created
- [ ] CONTENT_CALENDAR_FINAL.md created with all posts
- [ ] CONTENT_CALENDAR_FINAL.json created with valid structure
- [ ] Source data archived
- [ ] Temp files cleaned up
- [ ] Checkpoint saved

---

## Next Stage

-> [Stage 5.5: Post Persistence](./05.5-post-persistence.md)
